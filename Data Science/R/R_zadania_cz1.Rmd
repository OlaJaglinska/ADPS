---
title: "JÄ™zyk R - zadania projektowe"
author: "Ola JagliÅ„ska"
output:
  pdf_document:
    latex_engine: xelatex
  html_notebook: default
  html_document: default
---
```{r, echo=FALSE}
pdf.options(encoding='ISOLatin2')
```


## Zadanie 1
ProszÄ™ dla kredytu hipotecznego z ratÄ… staÅ‚Ä… udzielonego na kwotÄ™ K,
przy rocznej stopie oprocentowania r, zaciÄ…gniÄ™tego na okres n
miesiÄ™cy wyznaczyÄ‡:
PrzykÅ‚adowe dane: kwota kredytu = 100 000; roczna stopa oprocentowania = 2%; okres = 36 miesiÄ™cy.

1. wysokoÅ›Ä‡ oprocentowanie miesiÄ™cznego 

```{r}
K <- 100000
r <- 0.02
n <- 36
q <- 1 + (r/12)
cat('wysokoÅ›Ä‡ oprocentowania miesiÄ™czenego wyniesie:', q)
```

2. wysokoÅ›Ä‡ raty miesiÄ™cznej 
```{r}
R <- K * q**n * ((q-1)/(q**n-1))
cat('wysokoÅ›Ä‡ raty miesiÄ™cznej', R)
```
3. caÅ‚kowitÄ… kwotÄ™ do spÅ‚aty

```{r}
F <- R * n
cat('caÅ‚kowitÄ… kwotÄ™ do spÅ‚aty', F)
```

## Zadanie 2
ProszÄ™ dla kredytu hipotecznego z ratÄ… malejÄ…cÄ… udzielonego na kwotÄ™
K, przy rocznej stopie oprocentowania r, zaciÄ…gniÄ™tego na okres n
miesiÄ™cy wyznaczyÄ‡:
PrzykÅ‚adowe dane: kwota kredytu = 100 000; roczna stopa oprocentowania = 2%; okres = 36 miesiÄ™cy.

1. wysokoÅ›Ä‡ czÄ™Å›ci kapitaÅ‚owej raty

```{r}
K <- 100000
r <- 0.02
n <- 36
R_0 <- K/n
cat('wysokoÅ›Ä‡ czÄ™Å›ci kapitaÅ‚owej raty:', R_0)
```
2. wysokoÅ›Ä‡ czÄ™Å›ci odsetkowej raty i-tej
```{r}
czesc_odsetkowa_raty_nr <- function(i){
  n = 36
  Ri_1 <- ((K-(i-1)*R_0)*r)/12
  cat('WysokoÅ›Ä‡ czÄ™Å›ci odsetkowej raty nr', i, ':', Ri_1, '\n ')
}
rata_4 <- czesc_odsetkowa_raty_nr(4)
cat('WysykoÅ›Ä‡ czÄ™Å›ci odsetkowej dla raty 4:', rata_4)
```

3. wysokoÅ›Ä‡ raty i-tej ğ‘¹
```{r}
wysokosc_raty_nr <- function(i) {
    Ri_1 <- ((K-(i-1)*R_0)*r)/12
    Ri <- R_0 + Ri_1
    cat('WysokoÅ›Ä‡ raty nr', i, ':', Ri, '\n ')
}
rata_4 <- wysokosc_raty_nr(4)
print(rata_4)
```
4. caÅ‚kowitÄ… kwotÄ™ do spÅ‚aty

calkowita_kwota <- sum(wysokosc_raty_nr(i[1:36]) 
print(calkowita_kwota)

Jaka byÅ‚a najniÅ¼sza, Å›rednia i najwyÅ¼sza wartoÅ›Ä‡ raty?

najwyzsza_Ri <- max(wysokosc_raty_nr(n))
najniÅ¼sza_Ri <- min(wysokosc_raty_nr(n))
srednia <- mean(wysokosc_raty_nr(n))

<nie wiem jak to ugryÅºÄ‡>

## Zadanie 3
W pliku wig_changes.rds znajduje siÄ™ wektor uporzÄ…dkowanych
chronologicznie wartoÅ›ci tekstowych + oraz - reprezentujÄ…cych dni w ktÃ³rych
â€¢ (+) wartoÅ›Ä‡ indeksu WIG wzrosÅ‚a wzglÄ™dem wartoÅ›ci z dnia poprzedniego,
â€¢ (-) wartoÅ›Ä‡ indeksu WIG zmalaÅ‚a wzglÄ™dem wartoÅ›ci z dnia poprzedniego.
BazujÄ…c na tym wektorze wyznacz nastÄ™pujÄ…cÄ… macierz:

```{r}
wig_changes <- readRDS('./wig_changes.rds')
saveRDS(wig_changes, file = './wig_changes.rds')
i3 <- 1:length(wig_changes)
as.numeric(TRUE)
as.numeric(FALSE)
pp <- (sum((wig_changes[i3] == '+' & wig_changes[i3+1] == '+'), na.rm = TRUE))/length(wig_changes)
pm <- (sum((wig_changes[i3] == '+' & wig_changes[i3+1] == '-'), na.rm = TRUE))/length(wig_changes)
mp <- (sum((wig_changes[i3] == '-' & wig_changes[i3+1] == '+'), na.rm = TRUE))/length(wig_changes)
mm <- (sum((wig_changes[i3] == '-' & wig_changes[i3+1] == '-'), na.rm = TRUE))/length(wig_changes)
kombinacje <- c(pp, pm, mp, mm)
macierz_WIG <- matrix(kombinacje, 2, 2)
print(macierz_WIG)
```
PodnieÅ› utworzonÄ… macierz do potÄ™gi 3.

```{r}
macierz_WIG3 <- macierz_WIG**3
print(macierz_WIG3)
```

Zadanie 4a
W ramach pewnego ubezpieczenia N klientÃ³w pÅ‚aci skÅ‚adkÄ™ wysokoÅ›ci K w zamian za moÅ¼liwoÅ›Ä‡
uzyskania kwoty F jeÅ¼eli nastÄ…pi zdarzenie. Zbuduj symulacjÄ™ tego ubezpieczenia na okres T miesiÄ™cy
zgodnie z poniÅ¼szym algorytmem.
1. Przyjmij ğ‘¡ = 1.
2. Wyznacz rezerwÄ™ na wypÅ‚aty: St = á‰Š
ğ¾ğ‘, ğ‘¡ = 1,
ğ‘†ğ‘¡âˆ’1 + ğ¾ğ‘, ğ‘¡ > 1.
3. Wyznacz liczbÄ™ wypÅ‚at: ğ‘ = # ğ‘›: ğ‘ğ‘› â‰¥ ğ¹ğ‘¡ 2
âˆ’1
0.9999 , ğ‘ğ‘› âˆ¼ ğ‘¡ 2 .
4. WypÅ‚aÄ‡ odszkodowania: ğ‘†ğ‘¡ = ğ‘†ğ‘¡ âˆ’ ğ‘ğ¹.
5. SprawdÅº pÅ‚ynnoÅ›Ä‡: ğ‘†ğ‘¡ â‰¥ 0.
1. JeÅ¼eli speÅ‚nione, to zmodyfikuj liczbÄ™ ubezpieczonych do N = N + n - o - a, gdzie n to losowa liczba z
przedziaÅ‚u od 0 do 100 nowych klientÃ³w, natomiast o to losowa liczba z przedziaÅ‚u od 0 do 90 klientÃ³w
rezygnujÄ…cych.
2. JeÅ¼eli nie speÅ‚nione, to firma zbankrutowaÅ‚a. Zatrzymaj algorytm przed czasem.
6. Przyjmij ğ‘¡ = ğ‘¡ + 1.
7. JeÅ¼eli ğ‘¡ â‰¤ ğ‘‡, to przejdÅº do 2, w przeciwnym przypadku KONIEC.


## Zadanie 5
Plik age.rds zawiera dane dotyczÄ…ce wieku klientÃ³w pewnego banku.
Przeanalizuj te dane pod kÄ…tem odpowiedzi na nastÄ™pujÄ…ce pytania.
```{r}
age <- readRDS('./age.rds')
saveRDS(age, file = './age.rds')
```
1. Jaki wiek ma najmÅ‚odszy i najstarszy klient?
```{r}
najmlodszy <- min(age, na.rm = TRUE)
najstarszy <- max(age, na.rm = TRUE)
cat(najmlodszy, '\n', najstarszy, sep = '')
```
2. Jaki jest przeciÄ™tny wiek klientÃ³w banku?
```{r}
sredni_wiek = mean(age, na.rm = TRUE)
round(sredni_wiek, 3)
```
3. Jak bardzo zrÃ³Å¼nicowani sÄ… klienci banku pod wzglÄ™dem wieku?
```{r}
roznica_wieku <- najstarszy - najmlodszy
cat('RÃ³Å¼nca wieku wynosi:', roznica_wieku)
```
4. Ilu klientÃ³w banku jest niepeÅ‚noletnich? Jaki to procent caÅ‚oÅ›ci?
```{r}
niepelnoletni <- sum(as.numeric(age < 18), na.rm = TRUE)
print(niepelnoletni)
```
5. Ilu klientÃ³w banku jest w wieku 30-50 lat? Jaki to procent caÅ‚oÅ›ci?
```{r}
wiek_30_50 <- sum(as.numeric(age >= 30 & age <= 50 ), na.rm = TRUE)
procent_30_50 <- (wiek_30_50*100/length(age))
print(procent_30_50)
```
6. Ilu klientÃ³w nie podaÅ‚o swojego wieku? Jaki to procent caÅ‚oÅ›ci?
```{r}
brak_wieku <- sum(is.na(age))/length(age)*100
cat(brak_wieku, '%', sep = '')
```
7. Ile klientÃ³w bank posiada w segmentach wiekowych [16,17], [18,24],
[25,34], [35,44], [45,64], [65,Inf]? Jaki to procent caÅ‚oÅ›ci?
```{r}
przedzialy <- cut(age, c(16,17, 18,24, 25,34, 35,44, 45,64, 65, Inf))
segmenty_wiekowe <- table(przedzialy)
segmenty_procent <- ((sum(segmenty_wiekowe[c(1,3,5,7,9,11)]))/length(age))*100
cat('Procent caÅ‚oÅ›ci:', ' ', segmenty_procent, '%', sep = '')
```


## Zadanie 6
Wykonanie poniÅ¼szego kodu spowoduje skonstruowanie prostego modelu linowego
zapisanego w postaci listy w obiekcie model. Wykonaj ten kod, a nastÄ™pnie:
1. przyjrzyj siÄ™ strukturze obiektu model
```{r}
c(4.17,5.58,5.18,6.11,4.50,4.61,5.17,4.53,5.33,5.14) -> ctl
c(4.81,4.17,4.41,3.59,5.87,3.83,6.03,4.89,4.32,4.69) -> trt
gl(2, 10, 20, labels = c("Ctl","Trt")) -> group
c(ctl, trt) -> weight
summary(lm(weight ~ group)) -> model
print(model)
```
2. znajdÅº i wyÅ›wietl wspÃ³Å‚czynniki modelu (coefficients),
```{r}
print(model$coefficients)
```

3. ZnajdÅº i wyÅ›wietl wartoÅ›ci resztowe modelu (residuals),
```{r}
print(model$residuals)
```
4. znajdÅº i wyÅ›wietl wartoÅ›Ä‡ dopasowanego R2
(adj.r.squared).
```{r}
print(model$adj.r.squared)
```

## Zadanie 7
ZaÅ‚aduj plik ugly_diamonds.csv do R w postaci poprawnej ramki danych, tzn. ramki danych, ktÃ³ra speÅ‚nia
poniÅ¼szÄ… specyfikacjÄ™:
'data.frame': 10 obs. of 10 variables:
$ carat : num 0.23 0.21 0.23 0.29 0.31 0.24 0.24 0.26 0.22 0.23
$ cut : chr "Ideal" "Premium" "Good" "Premium" ...
$ color : chr "E" "E" "E" "I" ...
$ clarity: chr "SI2" "SI1" "VS1" "VS2" ...
$ depth : num 61.5 59.8 56.9 62.4 NA 62.8 62.3 61.9 65.1 59.4
$ table : int 55 61 65 58 58 57 57 55 61 61
$ price : int 326 326 327 334 335 336 336 337 337 338
$ x : num 3.95 3.89 4.05 4.2 4.34 3.94 3.95 4.07 3.87 4
$ y : num 3.98 3.84 4.07 4.23 4.35 3.96 3.98 4.11 3.78 4.05
$ z : num 2.43 2.31 2.31 2.63 2.75 2.48 2.47 2.53 2.49 2.39

```{r}
read.table(
  './ugly_diamonds.csv',
  header = TRUE, sep = '%', quote = '"', dec = ',',
  stringsAsFactors = FALSE
) -> ugly_diamonds
str(ugly_diamonds)
```

Zadanie 9
Plik albums.csv zawiera nastÄ™pujÄ…ce dane dotyczÄ…ce albumÃ³w muzycznych:
â€¢ artist_id â€“ dentyfikator artysty,
â€¢ album_title â€“ tytuÅ‚ albumu,
â€¢ genre â€“ gatunek muzyczny,
â€¢ year_of_pub â€“ rok publikacji,
â€¢ num_of_tracks â€“ liczba piosnek na pÅ‚ycie,
â€¢ num_of_sales â€“ liczba sprzedanych pÅ‚yt,
â€¢ rolling_stone_critic â€“ ocena Rolling Stone Magazine,
â€¢ mtv_critic â€“ ocena MTV,
â€¢ music_maniac_critic â€“ ocena Music Maniac.
BazujÄ…c na zdobytej dotychczas wiedzy przeprowadÅº prostÄ… analizÄ™ tej prÃ³bki

```{r}
albums <- read.csv('./albums.csv', stringsAsFactors = FALSE)
max_sales <- max(albums$num_of_sales)
max_sales_name <- albums$album_title[albums$num_of_sales == max_sales]
cat('NajwiÄ™ksza sprzedaÅ¼ pÅ‚yt:', max_sales, 'Nazwa albumu:', max_sales_name, '\n')
min_sales <- min(albums$num_of_sales)
min_sales_name <- albums$album_title[albums$num_of_sales == min_sales]
cat('NajniÅ¼sza sprzedaÅ¼ pÅ‚yt:', min_sales, 'Nazwa albumu:', min_sales_name)
```

```{r}
max_rolling <- max(albums$rolling_stone_critic)
max_rolling_percent <- (sum(as.numeric(albums$rolling_stone_critic == max_rolling)))/length(albums$rolling_stone_critic)*100
cat('NajwiÄ™ksza ocena Rolling Stone Magazine:', max_rolling, '\nProcent caÅ‚oÅ›ci:', max_rolling_percent, '% \n')
min_rolling <- min(albums$rolling_stone_critic)
min_rolling_percent <- (sum(as.numeric(albums$rolling_stone_critic == min_rolling)))/length(albums$rolling_stone_critic)*100
cat('NajniÅ¼sza ocena Rolling Stone Magazine:', min_rolling, '\nProcent caÅ‚oÅ›ci:', min_rolling_percent, '% \n')
```
```{r}
genre_percent <- function(genre) {
  result <- (sum(as.numeric(albums$genre == genre)))/length(albums$genre)*100
  return(cat('Procentowa zawartoÅ›Ä‡ dla gatunku:', genre, result, "% \n"))
}
genre_percent("Rock")
genre_percent("Rap")
genre_percent("Jazz")
genre_percent("Punk")
genre_percent("Disco")
```
